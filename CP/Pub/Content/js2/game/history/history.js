(function(c,e){var b=function(g,h){c.dialog(c.extend({title:"提示",css:"betDialog history_dialog",button:["*确定"],content:"",dragable:1,animate:0},g),h||c.noop)};function a(h,g,j,i){j=j||c.noop;e.post(h,g,j,i)}function d(g){b({content:'<div class="history_alert"><em class="ico_gantan"></em><span>'+g+"</span></div>",width:430,height:245})}function f(h,j,g,k,i){this.$el=c(h);this.gameEn=j;this.gameCn=g;this.getDataFun=k;this.randomFun=i;this.$el.bind("click",c.proxy(this.open,this));return this}c.extend(f.prototype,{open:function(){var g=this;this.stakeNumber=this.getDataFun();if(!this.stakeNumber.length){b({button:["*机选一注","返回选号"],content:'<div class="history_alert"><em class="ico_gantan"></em><span>号码篮至少有一注号码才能验证。</span></div>',width:430,height:245},function(h){if(h===1){g.randomFun()}})}else{this.getWinningRecordsStatistics()}},getWinningRecordsStatistics:function(h){var g=this;a("/calcHistory/winningRecordsStatistics.html",{stakeNumber:this.stakeNumber,gameEn:this.gameEn,periods:h||0},function(m,k){var l,q,i,s,o='<dd><span class="co1">{levelName}</span><span class="co2">{awardNum}</span><span class="co3">{lastTime}</span><span class="co4">{awardNo}</span><span class="co5">{detail}</span></dd><dd class="history_level_detail js_level_{levelId} hide"></dd>';try{q=JSON.parse(k)}catch(j){}if(!q||!c.isArray(q.data)){q=parseInt(q,10);var r="";switch(q){case -2:r="选号过多，无法统计中奖历史。";break;default:r="服务器有点忙，稍候再试吧。";break}d(r);return}l=q.data;s=q.currentPeriod;i=c.map(l,function(t){var v=t.awardNo,u=v.split(":");return c.format(o,c.extend({},t,t.awardNum==0?{detail:"--",lastTime:"--",awardNo:"--"}:{detail:'<a href="javascript:;" data-award-num="'+t.awardNum+'" data-level="'+t.levelId+'">明细<i></i></a>',awardNo:'<em class="c_ba2636">'+u[0]+'</em><em class="c_1e50a2">:'+u[1]+"</em>"}))}).join("");if(i){var n;if(l[0].awardNum==0&&l[1].awardNum==0){n="截至"+s+"期，该组号码历史上没有中出过一等奖或二等奖，可以放心投注"}else{n="截至"+s+"期，该组号码中过一等奖"+l[0].awardNum+"次、二等奖"+l[1].awardNum+"次，投注请注意"}i='<dt><span class="co1">奖级</span><span class="co2">中奖次数</span><span class="co3">最新中奖</span><span class="co4">当期号码</span><span class="co5">查看</span></dt>'+i+"</dl>";if(!g.$statisticsDialog){g.openWinningRecordsStatisticsDialog(function(){var t=g.$statisticsDialog.find(".history_table");t.html(i).end().find(".history_tip p").html(n);t.height(t.height())})}else{var p=g.$statisticsDialog.find(".history_table");p.html(i).end().find(".history_tip p").html(n);p.height(p.height())}}},"main")},openWinningRecordsStatisticsDialog:function(h){var g=this;b({title:"该组号码与"+this.gameCn+'<select class="history_periods_select"><option value="0">全部期次</option><option value="30">最近30期</option><option value="100">最近100期</option><option value="500">最近500期</option></select>开奖号对比如下',width:550,height:0,button:[],content:'<dl class="history_table"></dl><div class="history_tip"><p></p><a href="javascript:;" rel="1" class="iDialogBtn focusBtn"><span>确定</span></a></div>',init:function(){g.$statisticsDialog=c(this);g.initEvent();h&&h()},check:function(){g.$statisticsDialog=null}},function(){g.$statisticsDialog=null})},initEvent:function(){var h=this,g=this.$statisticsDialog.find(".history_periods_select");g.change(function(){h.getWinningRecordsStatistics(c(this).val())});this.$statisticsDialog.delegate("a[data-level]","click",function(){var m=c(this),i=m.parents(".history_table"),l=m.parents("dd"),k=m.attr("data-level"),n=h.$statisticsDialog.find(".js_level_"+k),j=+m.attr("data-award-num");if(l.is(".history_open_row")){l.removeClass("history_open_row");n.hide()}else{a("/calcHistory/winningRecordsDetail.html",{stakeNumber:h.stakeNumber,gameEn:h.gameEn,levelId:k,periods:g.val()},function(t,q){var p,o;try{p=JSON.parse(q)}catch(s){}if(!c.isArray(p)){p=parseInt(p,10);var r="";switch(p){default:r="服务器有点忙，稍候再试吧。";break}d(r);return}o=c.map(p,function(w,u){var v=w.concat([u%2===0?"":"history_even_row"]),x=v[2].split(":");v[2]='<em class="c_ba2636">'+x[0]+'</em><em class="c_1e50a2">:'+x[1]+"</em>";return c.format('<dd class="{3}"><span class="co1">{0}</span><span class="co2">{1}</span><span class="co3">{2}</span></dd>',v)}).join("");if(o){o="<div>"+o+"</div>";if(j>10){o+='<dd class="history_detail_tip">*共中奖'+j+"次，以上为近10次中奖明细</dd>"}o='<dl><dt><span class="co1">期次</span><span class="co2">开奖日</span><span class="co3">开奖号码</span></dd></dt>'+o+"</dl>";h.$statisticsDialog.find(".history_open_row").removeClass("history_open_row").end().find(".history_level_detail:visible").hide();l.addClass("history_open_row");n.html(o).show();i.scrollTop(l.offset().top+i.scrollTop()-i.offset().top)}},"detail")}})}});e.CompareHistory=f})(window.jQuery,window.Core);