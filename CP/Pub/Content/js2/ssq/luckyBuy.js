(function(b,c,f,g,e){var a=g.regBaseCom2Lib("ssq.luckyBuy","onChange",{config:{wrap:"",currentPeriod:"",tabWrap:".luckbuy_nav",numSelector:".zhushu dd a"},init:function(k){var j=g.getType(k),h=this;switch(j){case"string":case"element":this.config=c.extend({},this.config,{wrap:k});break;case"object":if(k.jquery){this.config=c.extend({},this.config,{wrap:k});break}this.config=c.extend({},this.config,k||{});break;default:return}var i=c(this.config.wrap);g.loadMolude("ssq.clientRandom");if(i[0]){this.cache={wrap:i};__initCtrl.call(this,i)}},getData:function(){var h=this.getKey(true);if(h.key){h.data=this.getDataCore(this.config.currentPeriod,h.key,h.num)}else{h.data=[]}return h},setPeriod:function(h){if(h){this.config.currentPeriod=h}return this},getKey:function(n){if(!this.cache){alert("无用户界面，无法获取数据，请访问getDataCore接口。");return{}}if(!this.config.currentPeriod){alert("请先设定期次信息！");return{}}var k=this.cache.wrap,j=k.find(this.config.tabWrap).find(".active").attr("rel").substr(1),l=c("#"+j),m,i={key:null,num:""},h=l.find(this.config.numSelector).filter(".active").html();switch(j){case"luckyShengxiao":case"luckyXingzuo":m=l.find(".buyList .active");if(m[0]){i.key="li"+m.parent()[0].className}else{i.err=j=="luckyXingzuo"?"您还没有选择星座，请选择星座后再获取幸运号码。":"您还没有选择生肖，请选择生肖后再获取幸运号码。"}if(n){m.removeClass("active");this.callEvent(100,"onChange","src")}break;case"luckyShengri":i.key="brithday"+l.find("[name=year]").val()+l.find("[name=month]").val()+l.find("[name=day]").val();break;case"luckyXingming":m=l.find("[name=yourName]").val().trim();if(m){i.key="yourName"+m}else{i.err="姓名不能为空，请输入姓名后再获取幸运号码。"}break;case"luckyQinglv":m={girl:l.find("[name=girlName]").val().trim(),boy:l.find("[name=boyName]").val().trim()};if(m.girl&&m.boy){i.key="lover"+m.girl+"love"+m.boy}else{i.err=!m.girl&&!m.boy?"姓名不能为空，请输入姓名后再获取幸运号码。":!m.girl?"女生姓名不能为空，请输入女生姓名后再获取幸运号码。":"男生姓名不能为空，请输入男生姓名后再获取幸运号码。"}break;case"luckyShoujihao":m=l.find("[name=phone]").val().trim();if(m){if(/^(?:13|14|15|18)\d{9}$/.test(m)){i.key="phone"+m}else{i.err="您输入的号码格式有误，请输入正确的手机号码。"}}else{i.err="手机号码不能为空，请输入手机号码后再获取幸运号码。"}break}i.num=+(h||5);return i},getDataCore:function(p,l,j){if(!l){return[]}var i="MC_"+l,o=b.LS.get("ssqLuckyData")||"",m={period:p||this.config.currentPeriod,data:{}},h,q=j||1;if(o){m=b.JSON.parse(o)}if(m.period!==p){m={period:p,data:{}}}h=m.data[i]||[];if(h.length<q){h=h.concat(d(j-h.length));m.data[i]=h;b.LS.set("ssqLuckyData",b.JSON.stringify(m))}h=h.slice(0,q);c.each(h,function(k,n){n.random=1;n.type="lucky"});return h}});var d=function(l){if(g.ssq.clientRandom){return g.ssq.clientRandom(l)}else{var j=[],k,h;for(h=0;h<l;h++){k=[g.random("1-33",6),g.random("1-16",1)];k.random=1;j[h]=k}return j}};__initCtrl=function(i){var h=this;i.find(this.config.tabWrap).bindTab(function(){h.callEvent(100,"onChange","tab")});i.delegate(this.config.numSelector,"click focus",function(){var j=c(this);j.siblings(".active").removeClass("active");j.addClass("active");h.callEvent(100,"onChange","num")});c("#luckyShengxiao,#luckyXingzuo").delegate("li a","click focus",function(){var j=c(this);j.closest("ul").find(".active").removeClass("active");j.addClass("active");h.callEvent(100,"onChange","src")});f.loadCdnJS("js2/jselect.js",function(){return !!c.fn.jSelect&&!!c.fn.bindLiveCheck},function(){var l=f.serverTime(),n=c("#luckyShengri"),j=l.getFullYear()+1,p=j-93;n.find(".mcSelectBox").jSelect(function(q){if(!c(q.wrap).hasClass("day")){_updateDayList(k,m.val(),o.val())}});n.find(".mcSelectBox input").mouseenter(function(){this.select()});var m=c("#luckyShengri").find("[name=year]").val("1980").blur(function(){var q=+(this.value||1980);q=q<p||q>j?1980:q;this.value=q;_updateDayList(k,q,o.val())}),o=c("#luckyShengri").find("[name=month]").val("08").blur(function(){var q=this.value||8;q=q>12?8:q;this.value=g.fillZero(q);_updateDayList(k,m.val(),q)}),k=c("#luckyShengri").find("[name=day]").val("08").blur(function(){var t=m.val(),r=o.val(),s=this.value||8,q=_getMaxDay(t,+r-1);s=s>q?8:s;this.value=g.fillZero(s)});_initYearList(m,p,j);_initMonthList(o,1,12);_updateDayList(k,1980,8)});f.loadCdnJS("js2/liveCheck.js",function(){return !!c.fn.bindLiveCheck},function(){c("#luckyShengri .mcSelectBox input").bindNumberLiveCheck();c("#luckyShoujihao input").bindNumberLiveCheck().keyup(function(){h.callEvent(100,"onChange","phone")}).val("")});c("#luckyXingming input,#luckyQinglv input").keyup(function(){h.callEvent(100,"onChange","name")}).val("")},_daysInMonth=[31,28,31,30,31,30,31,31,30,31,30,31],_getMaxDay=function(h,i){return i==1?((h%4==0&&h%100!=0)||h%400==0)?29:28:_daysInMonth[i]},_initYearList=function(m,l,h){var k=[],j=+h,o=+l;for(;j>=o;j--){k.push('<a href="#'+j+'">'+j+"</a>")}m.closest(".mcSelectBox").find(".optionList").html(k.join(""))},_initMonthList=function(k){var j=[],h=1,l=12;for(;h<=l;h++){j.push('<a href="#'+g.fillZero(h)+'">'+g.fillZero(h)+"</a>")}k.closest(".mcSelectBox").find(".optionList").html(j.join(""))},_updateDayList=function(p,m,o){var l=[],k=1,q=_getMaxDay(+m,+o-1);for(;k<=q;k++){l.push('<a href="#'+g.fillZero(k)+'">'+g.fillZero(k)+"</a>")}p.closest(".mcSelectBox").find(".optionList").html(l.join(""));var j=c("#luckyShengri").find("[name=day]"),h=+(j.val()||99);h>q&&j.val(q)}})(window,jQuery,Core,Game);